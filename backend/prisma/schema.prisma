generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id               String  @id @default(cuid())
  name             String?
  bio              String?
  email            String  @unique
  password         String?
  avater           String?
  avater_public_id String?

  createdAt DateTime @default(now())

  sentMessage    Message[] @relation("SentMessage")
  receiveMessage Message[] @relation("ReceiveMessage")

  sentConversations     Conversation[] @relation("SenderConversations")
  receivedConversations Conversation[] @relation("ReceiverConversations")

  adminOfGroups   Group[] @relation("GroupAdmin")
  membersOfGroups Group[] @relation("GroupMembers")
}

model Message {
  id         String  @id @default(cuid())
  senderId   String
  receiverId String?
  text       String?
  image      String?

  conversation   Conversation? @relation(fields: [conversationId], references: [id])
  conversationId String?

  sender   User  @relation("SentMessage", fields: [senderId], references: [id])
  receiver User? @relation("ReceiveMessage", fields: [receiverId], references: [id])

  group   Group?  @relation(fields: [groupId], references: [id])
  groupId String?

  createdAt DateTime @default(now())
}

model Conversation {
  id         String @id @default(cuid())
  senderId   String
  receiverId String

  sender   User @relation("SenderConversations", fields: [senderId], references: [id])
  receiver User @relation("ReceiverConversations", fields: [receiverId], references: [id])

  messages Message[]
}

model Group {
  id                     String  @id @default(cuid())
  groupsAvater           String?
  groupsAvater_public_id String?
  name                   String
  bio                    String?
  // Group Admin
  groupAdminId           String?
  admin                  User?   @relation("GroupAdmin", fields: [groupAdminId], references: [id])
  // Group Members
  members                User[]  @relation("GroupMembers")

  messages  Message[]
  createdAt DateTime  @default(now())
}
